name: Fetch BF6 Stats (API - Final URL)

on:
  # Umo≈æ≈àuje spustit akci manu√°lnƒõ
  workflow_dispatch: 
  # Spou≈°t√≠ se automaticky ka≈æd√Ω den v 01:00 UTC
  schedule:
    - cron: '0 1 * * *' 

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write 
      
    steps:
      - name: Checkout k√≥d
        uses: actions/checkout@v4

      - name: Vytvo≈ôen√≠ slo≈æky pro data
        run: mkdir -p data

      - name: St√°hni JSON data z Tracker.gg API
        # P≈ôedpoklad: NOV√ù, PLATN√ù kl√≠ƒç je ulo≈æen v Secrets
        env:
          API_KEY: ${{ secrets.TRN_API_KEY }} 
        run: |
          # üö® ZDE JE NOV√Å, OPRAVEN√Å URL ADRESA:
          URL="https://api.tracker.gg/api/v2/bf6/standard/profile/steam/3000691765"
          PLAYER_ID="3000691765"
          OUTPUT_FILE="data/bf6_stats.json"
          
          echo "Stahuji data z nov√© URL pro Steam ID ${PLAYER_ID}..."
          
          # Curl p≈ô√≠kaz s API kl√≠ƒçem v hlaviƒçce
          curl -s -X GET \
            -H "TRN-Api-Key: $API_KEY" \
            -H "Accept: application/json" \
            "$URL" \
            --compressed \
            --output "$OUTPUT_FILE"
          
          # Kontrola, zda sta≈æen√≠ probƒõhlo a soubor nen√≠ pr√°zdn√Ω
          if [ -f "$OUTPUT_FILE" ] && [ -s "$OUTPUT_FILE" ]; then
              echo "‚úÖ Data √∫spƒõ≈°nƒõ sta≈æena do $OUTPUT_FILE"
          else
              echo "‚ùå CHYBA: Sta≈æen√Ω soubor je pr√°zdn√Ω nebo neexistuje. (Pravdƒõpodobnƒõ st√°le neplatn√Ω kl√≠ƒç nebo chyba API)."
              exit 1 
          fi

      - name: Commit a Push JSON souboru
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'data/bf6_stats.json' 
          commit_message: 'Auto-update: BF6 Stats with correct API URL'
          commit_author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
