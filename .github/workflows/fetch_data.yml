name: Fetch BF6 Stats and Update

on:
  # Umo≈æ≈àuje spustit akci manu√°lnƒõ
  workflow_dispatch: 
  # Spou≈°t√≠ se automaticky ka≈æd√Ω den v 01:00 UTC
  schedule:
    - cron: '0 1 * * *' 

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    
    # üö® D≈Øle≈æit√©: Nastaven√≠ opr√°vnƒõn√≠ pro commitov√°n√≠ dat zpƒõt do repozit√°≈ôe
    permissions:
      contents: write 
      
    steps:
      - name: Checkout k√≥d
        uses: actions/checkout@v4

      - name: Vytvo≈ôen√≠ slo≈æky pro data
        run: mkdir -p data

      - name: St√°hni JSON data z Tracker.gg
        # 1. Kl√≠ƒç je bezpeƒçnƒõ p≈ôed√°n jako promƒõnn√° prost≈ôed√≠ (API_KEY)
        env:
          API_KEY: ${{ secrets.TRN_API_KEY }} 
        run: |
          # Konfigurace pro Tracker.gg API
          PLAYER_ID="3000691765"
          URL="https://public-api.tracker.gg/v2/bf6/standard/profile/steam/${PLAYER_ID}"
          OUTPUT_FILE="data/bf6_stats.json"
          
          echo "Stahuji data pro Steam ID ${PLAYER_ID}..."
          
          # 2. Curl p≈ô√≠kaz: Zaji≈°≈•uje, ≈æe hlaviƒçka TRN-Api-Key je spr√°vnƒõ nastavena
          # Pou≈æ√≠v√°me promƒõnnou prost≈ôed√≠ $API_KEY
          curl -s -X GET \
            -H "TRN-Api-Key: $API_KEY" \
            -H "Accept: application/json" \
            "$URL" \
            --compressed \
            --output "$OUTPUT_FILE"
          
          # Kontrola, zda sta≈æen√≠ probƒõhlo a soubor existuje
          if [ -f "$OUTPUT_FILE" ]; then
              echo "Data sta≈æena do $OUTPUT_FILE"
          else
              echo "‚ùå CHYBA: Soubor $OUTPUT_FILE nebyl vytvo≈ôen. Zkontroluj logy pro chyby API."
              exit 1 # Ukonƒç√≠ akci, pokud se soubor nest√°hl
          fi

      - name: Commit a Push JSON souboru
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'data/bf6_stats.json' 
          commit_message: 'Auto-update: BF6 Stats from Tracker.gg API'
          # Nastavujeme spr√°vn√©ho autora pro push
          commit_author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
