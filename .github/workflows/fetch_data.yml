name: Fetch BF6 Stats (API)

on:
  workflow_dispatch: 
  schedule:
    - cron: '0 1 * * *' 

jobs:
  fetch-data:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write 
      
    steps:
      - name: Checkout kód
        uses: actions/checkout@v4

      - name: Vytvoření složky pro data
        run: mkdir -p data

      - name: Stáhni JSON data z Tracker.gg API
        # Klíč je bezpečně předán jako proměnná prostředí (API_KEY)
        env:
          API_KEY: ${{ secrets.TRN_API_KEY }} 
        run: |
          # Konfigurace pro Tracker.gg API
          PLAYER_ID="3000691765"
          URL="https://public-api.tracker.gg/v2/bf6/standard/profile/steam/${PLAYER_ID}"
          OUTPUT_FILE="data/bf6_stats.json"
          
          echo "Stahuji data pro Steam ID ${PLAYER_ID}..."
          
          # Curl příkaz: Zajišťuje, že hlavička TRN-Api-Key je správně nastavena
          # Používá proměnnou prostředí $API_KEY
          curl -s -X GET \
            -H "TRN-Api-Key: $API_KEY" \
            -H "Accept: application/json" \
            "$URL" \
            --compressed \
            --output "$OUTPUT_FILE"
          
          # Kontrola, zda stažení proběhlo a soubor existuje
          if [ -f "$OUTPUT_FILE" ] && [ -s "$OUTPUT_FILE" ]; then
              echo "Data stažena do $OUTPUT_FILE"
          else
              echo "❌ CHYBA: Soubor $OUTPUT_FILE nebyl vytvořen nebo je prázdný. Zkontroluj logy."
              exit 1 
          fi

      - name: Commit a Push JSON souboru
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: 'data/bf6_stats.json' 
          commit_message: 'Auto-update: BF6 Stats from Tracker.gg API'
          commit_author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
